<!DOCTYPE html>
<html lang="en-us">
    <head>
        <meta charset="utf-8" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title>Topography Example</title>
        <style></style>
    </head>
    <body>
        <div class="container">
            <canvas id="canvas" oncontextmenu="event.preventDefault()"></canvas>
        </div>
        <script src="vizgl-wrapper-umd.js"></script>

        <script>
            const vizgl = window.vizgl;
            let module;
            let geometryApi;
            let colorMapApi;
            let mappingApi;
            let modelApi;

            function generateMappingData(dims) {
                const [x, y, z] = dims;
                const data = new Float32Array(x * y * z);
                // for (let k = 0; k < z; k++) {
                //     for (let j = 0; j < y; j++) {
                //         for (let i = 0; i < x; i++) {
                //             const index = k * y * z + j * y + i;
                //             data[index] = index % 3 == 0 ? NaN : 1.0;
                //         }
                //     }
                // }
                return data;
            }

            async function loadBlockModel() {
                return new Promise(() => {
                    // const dims = [512, 512, 512];
                    // const dims = [374, 263, 197];
                    const dims = [256, 256, 256];
                    console.log({ blockCount: dims[0] * dims[1] * dims[2] });

                    // const dims = [1, 1, 1];
                    const geometryId = geometryApi.createVoxelMesh(dims);

                    const color = [19, 55, 130];
                    const data = generateMappingData(dims);
                    const mappingId = mappingApi.createVoxelMapping(data, color, geometryId);

                    const modelId = modelApi.createModel(geometryId, mappingId);

                    console.log({ geometryId, mappingId });
                });
            }

            Module = {
                canvas: document.getElementById('canvas'),

                onRuntimeInitialized: () => {
                    module = new vizgl.ModuleWrapper(Module);
                    geometryApi = new vizgl.GeometryApi(module);
                    colorMapApi = new vizgl.ColorMapApi(module);
                    mappingApi = new vizgl.MappingApi(module);
                    modelApi = new vizgl.ModelApi(module);

                    // Wait for gl context to be created an initialized (need main to run first)
                    setTimeout(() => {
                        loadBlockModel();
                    }, 1);
                },
            };
        </script>

        <script async type="text/javascript" src="vizgl.js"></script>
    </body>
</html>
