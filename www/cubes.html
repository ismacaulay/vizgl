<!DOCTYPE html>
<html lang="en-us">
    <head>
        <meta charset="utf-8" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <style></style>
    </head>
    <body>
        <div class="container">
            <canvas id="canvas" oncontextmenu="event.preventDefault()"></canvas>
        </div>
        <script src="vizgl-wrapper-umd.js"></script>

        <script>
            const vizgl = window.vizgl;

            Module = {
                canvas: document.getElementById('canvas'),

                onRuntimeInitialized: () => {
                    const module = new vizgl.ModuleWrapper(Module);
                    const geometryApi = new vizgl.GeometryApi(module);
                    const colorMapApi = new vizgl.ColorMapApi(module);
                    const mappingApi = new vizgl.MappingApi(module);
                    const modelApi = new vizgl.ModelApi(module);

                    fetch('res/cube.json').then(response =>
                        response.json().then(geometryData => {
                            const { vertices } = geometryData;

                            fetch('res/cube-data.json').then(response =>
                                response.json().then(data => {
                                    const { data: cubeData, gradient } = data;

                                    console.log({ vertices, cubeData, gradient });
                                    const geometryId = geometryApi.createMesh(vertices);
                                    const colorMapId = colorMapApi.createColorMap(gradient);

                                    // const color = [116, 191, 165];
                                    // const mappingId = mappingApi.createStaticMapping(color);
                                    const mappingId = mappingApi.createContinuosMapping(
                                        cubeData,
                                        colorMapId,
                                    );

                                    const modelId = modelApi.createModel(geometryId, mappingId);
                                    console.log({ geometryId, mappingId });

                                    //   const mappingId = mappingApi.createContinuousMapping({
                                    //     data,
                                    //     colorMap: colorMapId
                                    //   });

                                    //   modelApi.createModel(geometryId, mappingId);
                                    //   })
                                    // );
                                    // const cube1 = vertices.map((v, i) => {
                                    //   if (i % 3 == 0) {
                                    //     return v + 1.0;
                                    //   }
                                    //   return v;
                                    // });
                                    // const cube2 = vertices.map((v, i) => {
                                    //   if (i % 3 == 0) {
                                    //     return v - 1.0;
                                    //   }
                                    //   return v;
                                    // });
                                }),
                            );
                        }),
                    );
                },
            };
        </script>

        <script async type="text/javascript" src="vizgl.js"></script>
    </body>
</html>
